@echo off
echo [0;94m[PreStartup][0;0m Checking permissions...
net session >nul 2>&1
if %errorlevel% == 0 (
  goto errorAdmin
)
echo [0;94m[PreStartup][0;0m Checking internet connection...
ping www.google.com -n 1 -w 1000>nul
if errorlevel 1 (set internet=none& goto ErrorInternet) else (set internet=connected & echo [0;94m[PreStartup][0;0m Connected)

:reload
setlocal EnableDelayedExpansion
mode con cols=120 lines=30
@echo off
echo Starting up...
if not exist Command_Miner_Data md Command_Miner_Data & echo [0;94m[Startup][0;0m Creating Command_Miner_Data folder
cd Command_Miner_Data & echo [0;94m[Startup][0;0m Entering Command_Miner_Data folder
if errorlevel=1 echo [0;94m[Startup][0;0m Failed to create folder! & pause >nul & exit
if not exist Command_Miner_Update md Command_Miner_Update & echo [0;94m[Startup][0;0m Creating Command_Miner_Update folder
cd Command_Miner_Update & echo [0;94m[Startup][0;0m Entering Command_Miner_Update folder
if errorlevel=1 echo [0;94m[Startup][0;0m Failed to create folder! & pause >nul & exit
echo [0;94m[Startup][0;0m Setting up update feature...
if not exist Update.bat echo cd.. ^& cd.. ^& curl https://fireroth.github.io/download/data/CommandMiner/latest^>CommandMiner.bat ^& cd Command_Miner_Data ^& cd Command_Miner_Update ^& start Updated.vbs ^& exit>Update.bat & goto update
if not exist Updated.vbs echo X=MsgBox("Successfully installed latest version.",0+64,"Updated Command Miner")>Updated.vbs
cd..
if not exist Config md Config & echo [0;94m[Startup][0;0m Creating Config folder
cd Config & if not exist cheatPerm.cmd echo set cheatPermission=false>cheatPerm.cmd & echo [0;94m[Startup][0;0m Creating cheatPerm.cmd file
if not exist debugPerm.cmd echo set debugPermission=false>debugPerm.cmd & echo [0;94m[Startup][0;0m Creating debugPerm.cmd file
cd..
if not exist Save md Save & echo [0;94m[Startup][0;0m Creating Save folder

echo [0;94m[Startup][0;0m Setting up important stuff...
set cheats=false
set command=invalid
set cheatPermission=false
set ver=1.0.3 MV

set /a minimumMined = 0
set pickaxe=Wooden
set backpack=Wooden
set money=0
set ore=0
set token=0
set oreName=Coal
set /a commonCrate=0
set /a uncommonCrate=0
set /a rareCrate=0
set /a epicCrate=0
set /a legendaryCrate=0
set dimension=Overworld
set /a rebirthReward=0

cd save
echo [0;94m[Startup][0;0m Calling saved files...
cd..
cd Config
cd..

cls
:main
curl https://fireroth.github.io/download/data/CommandMiner/logo
echo.
echo.
echo [0;91mMoved version, use [0;93mrepair[0;0m[0;91m to change the update library[0;0m
echo [0;91mAutomatic repair[0;0m

:cmdselect
set title=Command Miner (Moved Version)

if %oreName%== Coal set /a multi=1
if %oreName%== Iron set /a multi=1
if %oreName%== Lapis set /a multi=2
if %oreName%== Gold set /a multi=2
if %oreName%== Diamond set /a multi=3
if %oreName%== Emerald set /a multi=3
if %oreName%== Netherite set /a multi=4
if %oreName%== Negative set /a multi=2147483647
if %oreName%== OverLimit set /a multi=2147483648

if %orename% == Emerald set /a upOrePrice=6
if %orename% == Diamond set /a upOrePrice=5
if %orename% == Gold set /a upOrePrice=4
if %orename% == Lapis set /a upOrePrice=3
if %orename% == Iron set /a upOrePrice=2
if %orename% == Coal set /a upOrePrice=1

if %orename% == Emerald set nextore=Netherite
if %orename% == Diamond set nextore=Emerald
if %orename% == Gold set nextore=Diamond
if %orename% == Lapis set nextore=Gold
if %orename% == Iron set nextore=Lapis
if %orename% == Coal set nextore=Iron

if %pickaxe% == Emerald set /a upPickPrice=12000
if %pickaxe% == Diamond set /a upPickPrice=6000
if %pickaxe% == Golden set /a upPickPrice=3500
if %pickaxe% == Iron set /a upPickPrice=2000
if %pickaxe% == Stone set /a upPickPrice=750
if %pickaxe% == Wooden set /a upPickPrice=250

if %pickaxe% == Wooden set maxMined=10
if %pickaxe% == Stone set maxMined=20
if %pickaxe% == Iron set maxMined=40
if %pickaxe% == Golden set maxMined=60
if %pickaxe% == Diamond set maxMined=90
if %pickaxe% == Emerald set maxMined=120
if %pickaxe% == Netherite set maxMined=180

if %pickaxe% == Emerald set nextpickaxe=Netherite
if %pickaxe% == Diamond set nextpickaxe=Emerald
if %pickaxe% == Golden set nextpickaxe=Diamond
if %pickaxe% == Iron set nextpickaxe=Golden
if %pickaxe% == Stone set nextpickaxe=Iron
if %pickaxe% == Wooden set nextpickaxe=Stone

if %backpack% == Wooden set maxBPSize=25
if %backpack% == Stone set maxBPSize=75
if %backpack% == Iron set maxBPSize=150
if %backpack% == Golden set maxBPSize=250
if %backpack% == Diamond set maxBPSize=500
if %backpack% == Emerald set maxBPSize=700
if %backpack% == Netherite set maxBPSize=1200
if %backpack% == Infinite set maxBPSize=nul

if %backpack% == Emerald set /a upBPPrice=12000
if %backpack% == Diamond set /a upBPPrice=6000
if %backpack% == Golden set /a upBPPrice=3500
if %backpack% == Iron set /a upBPPrice=2000
if %backpack% == Stone set /a upBPPrice=750
if %backpack% == Wooden set /a upBPPrice=250

if %backpack% == Emerald set nextbp=Netherite
if %backpack% == Diamond set nextbp=Emerald
if %backpack% == Golden set nextbp=Diamond
if %backpack% == Iron set nextbp=Golden
if %backpack% == Stone set nextbp=Iron
if %backpack% == Wooden set nextbp=Stone

if %minimumMined% == 5 set /a upMinMinedPrice=0
if %minimumMined% == 4 set /a upMinMinedPrice=3
if %minimumMined% == 3 set /a upMinMinedPrice=3
if %minimumMined% == 2 set /a upMinMinedPrice=2
if %minimumMined% == 1 set /a upMinMinedPrice=1
if %minimumMined% == 0 set /a upMinMinedPrice=1

if %minimumMined% == 4 set nextMinMined=5
if %minimumMined% == 3 set nextMinMined=4
if %minimumMined% == 2 set nextMinMined=3
if %minimumMined% == 1 set nextMinMined=2
if %minimumMined% == 0 set nextMinMined=1

if %rebirthReward% == 0 set /a upRebirthRewardPrice=5
if %rebirthReward% == 1 set /a upRebirthRewardPrice=0
if %rebirthReward% == 0 set nextRebirthReward=1
if %rebirthReward% == 0 set /a tokenPlus=1
if %rebirthReward% == 1 set /a tokenPlus=2

title %title%
echo.
goto updateVM
set /p "command=Enter command:"
set count=0
for %%a in (%command%) do (
  set /a count+=1
  set command!count!=%%a
)

if "%command%" == "mine" goto mine
if "%command%" == "sell" goto sell
if "%command%" == "invalid" echo [0;31mPlease enter valid command![0;0m & goto cmdselect
if "%command%" == "stats" goto stats
if "%command%" == "clear" cls & goto cmdselect
if "%command%" == "shop" goto shop
if "%command%" == "reload" cls & cd.. & goto reload
if "%command%" == "help" goto help
if "%command%" == "save" goto saveProgress
if "%command%" == "balance" goto balance
if "%command%" == "rebirth" goto rebirth
if "%command%" == "cheat" echo Invalid syntax, use [0;93mcheat_CHEATNAME[0;0m & goto cmdselect
if "%command%" == "cheat_" echo Invalid syntax, use [0;93mcheat_CHEATNAME[0;0m & goto cmdselect
if "%command%" == "reset" goto resetConfirm
if "%command%" == "upgrade ore" goto upgradeore
if "%command%" == "upgrade backpack" goto upgradebp
if "%command%" == "upgrade pickaxe" goto upgradePick
if "%command%" == "ore" goto oreInfo
if "%command%" == "ores" goto oreInfo
if "%command%" == "ore info" goto oreInfo
if "%command%" == "open common" goto openCrateCommon
if "%command%" == "open uncommon" goto openCrateUncommon
if "%command%" == "open rare" goto openCrateRare
if "%command%" == "open epic" goto openCrateEpic
if "%command%" == "open legendary" goto openCrateLegendary
if "%command%" == "crates" goto allCrates
if "%command%" == "update" goto Update
if "%command%" == "version" goto version
if "%command%" == "tokenshop" goto tokenShop
if "%command%" == "buy1" goto upgradeMinMined
if "%command%" == "allcommands" goto allcomm
if "%command%" == "open" echo Invalid syntax, use [0;93mopen CRATE_NAME[0;0m & goto cmdselect
if "%command%" == "open all" echo Don't be lazy ;) & goto cmdselect
if "%command%" == "set" echo Invalid syntax, use [0;93mset SETTING_NAME[0;0m & goto cmdselect
if "%command%" == "exit" echo Exiting... & endlocal & exit
if "%command%" == "set help" goto setHelp
if "%command%" == "set /?" goto setHelp
if "%command%" == "buy2" goto upgradeRebirthReward
if "%command%" == "changelog" goto changeLog
if "%command%" == "repair" goto updateVM

REM debug
if "%command%" == "debug" goto debug_menu

echo [0;31mPlease enter valid command![0;0m
goto cmdselect


:setCheats
goto cmdselect

:setDebug
goto cmdselect

:sell
if %ore%==0 goto noOre
set /a transfer=%ore%*%multi%
set /a money=%money%+(%ore%*%multi%)
echo.
echo [0;32m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
echo You sold %ore% %orename% for %transfer%^$
echo [0;32m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
set /a ore=0
set command=invalid
goto cmdselect


:mine
if %ore% == %maxBPSize% goto maxBackPack 

set /a crateChance=%random% %% 75
if %crateChance%==25 set /a commonCrate=%commonCrate%+1 & echo [0;33mYou got 1 Common crate![0;0m

set /a crateChance1=%random% %% 100
if %crateChance1%==55 set /a uncommonCrate=%uncommonCrate%+1 & echo[0;33mYou got 1 Uncommon crate![0;0m

set /a crateChance2=%random% %% 200
if %crateChance2%==122 set /a rareCrate=%rareCrate%+1 & echo[0;33mYou got 1 Rare crate![0;0m

set /a crateChance3=%random% %% 450
if %crateChance3%==185 set /a epicCrate=%epicCrate%+1 & echo[0;33mYou got 1 Epic crate![0;0m

set /a crateChance4=%random% %% 850 
if %crateChance4%==468 set /a legendaryCrate=%legendaryCrate%+1 & echo[0;33mYou got 1 Legendary crate![0;0m



set /a oremined=%random% %% %maxMined%
if %oremined% LSS %minimumMined% set /a oremined = %oremined%+%minimumMined%
if %oremined% GTR %maxMined% set /a oremined = %maxMined%
set /a ore=%ore% + %oremined%
if %ore% GTR %maxBPSize% set /a ore=%maxBPSize%
echo You mined %oremined% %orename%
echo Now you have %ore% %orename%
set command=invalid
goto cmdselect


:upgradePick
if %pickaxe%== Netherite goto maxLevelPick
if %money% LSS %upPickPrice% goto lowMoneyPick
set /a money=%money%-%upPickPrice% & set pickaxe=%nextPickaxe%
echo You successfully bought %nextpickaxe% pickaxe.

goto cmdselect


:upgradeMinMined
if %minimumMined%== 5 goto maxLevelMinMined
if %token% LSS %upMinMinedPrice% goto lowTokenMMined
set /a token=%token%-%upMinMinedPrice% & set minimumMined=%nextMinMined%
echo You successfully upgraded "minimum mined" to %nextMinMined% level.

goto cmdselect


:upgradeRebirthReward
if %rebirthReward%== 1 goto maxLevelRebirthReward
if %token% LSS %upRebirthRewardPrice% goto lowTokenRebirthReward
set /a token=%token%-%upRebirthRewardPrice% & set rebirthReward=%nextRebirthReward%
echo You successfully upgraded "Rebirth token reward" to %nextRebirthReward% level.

goto cmdselect


:upgradeOre
if %orename% == Netherite goto maxLevelOre
if %token% LSS %upOrePrice% goto lowToken
set /a token=%token%-%upOrePrice% & set orename=%nextOre%
echo You successfully bought %nextore% ore.

goto cmdselect


:upgradeBP
if %backpack%== Netherite goto maxLevelBP
if %money% LSS %upBPPrice% goto lowMoneyBP
set /a money=%money%-%upBPPrice% & set backpack=%nextBP%
echo You successfully bought %nextbp% backpack.
goto cmdselect


:shop
echo.
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
echo Stone tier = 250^$
echo Iron tier = 750^$
echo Golden tier = 2 000^$
echo Diamond tier = 3 500^$
echo Emerald tier = 6 000^$
echo Netherite tier = 12 000^$
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
goto cmdselect


:stats
echo.
echo Pickaxe: %pickaxe%
echo Backpack: %backpack%
echo Money: %money%^$
echo Tokens: %token%
echo %orename%: %ore%
set /a totalCrates=%commonCrate%+%uncommonCrate%+%rareCrate%+%epicCrate%+%legendaryCrate%
echo Common crates: %commonCrate%
echo Uncommon crates: %uncommonCrate%
echo Rare crates: %rareCrate%
echo Epic crates: %epicCrate%
echo Legendary crates: %legendaryCrate%
echo Crates in total: %totalCrates%
goto cmdselect


:lowMoneyPick
set /a needMoreMoney=%upPickPrice%-%money%
echo [0;94m[Pickaxe][0;0m You don't have enough money!
echo [0;94m[Pickaxe][0;0m You need %needMoreMoney%^$ more for next upgrade!
goto cmdselect


:lowMoneyBP
set /a needMoreMoney=%upBPPrice%-%money%
echo [0;94m[Backpack][0;0m You don't have enough money!
echo [0;94m[Backpack][0;0m You need %needMoreMoney%^$ more for next upgrade!
goto cmdselect


:lowToken
set /a needMoreToken=%upOrePrice%-%token%
echo [0;94m[Ore][0;0m You don't have enough tokens!
echo [0;94m[Ore][0;0m You need %needMoreToken% token(s) more for next upgrade!
goto cmdselect


:lowTokenMMined
set /a needMoreToken=%upMinMinedPrice%-%token%
echo [0;94m[MinMined][0;0m You don't have enough tokens!
echo [0;94m[MinMined][0;0m You need %needMoreToken% token(s) more for next upgrade!
goto cmdselect

:lowTokenRebirthReward
set /a needMoreToken=%upMinMinedPrice%-%token%
echo [0;94m[RebirthReward][0;0m You don't have enough tokens!
echo [0;94m[RebirthReward][0;0m You need %needMoreToken% token(s) more for next upgrade!
goto cmdselect


:maxLevelPick
echo [0;94m[Pickaxe][0;0m You have the max level of your pickaxe.
goto cmdselect

:maxLevelMinMined
echo [0;94m[MinMined][0;0m You have the max level of your "minimum mined" skill.
goto cmdselect

:maxLevelRebirthReward
echo [0;94m[RebirthReward][0;0m You have the max level of your "Rebirth token reward" skill.
goto cmdselect

:maxLevelBP
echo [0;94m[Backpack][0;0m You have the max level of your backpack.
goto cmdselect

:maxLevelOre
echo [0;94m[Ore][0;0m You have the max level of your ore.
goto cmdselect

:maxBackpack
echo You have full backpack.
echo Use "sell" or "s" to make free space in your bp.
goto cmdselect


:noOre
echo You don't have any %orename% that you can sell.
goto cmdselect


:oreInfo
echo.
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
echo Coal = 1x sell price
echo Iron = 1x sell price
echo Lapis = 2x sell price
echo Gold = 2x sell price
echo Diamond = 3x sell price
echo Emerald = 3x sell price
echo Netherite = 4x sell price
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
goto cmdselect


:help
echo.
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
echo mine = Mine ores
echo sell = Sell ores that you mined
echo upgrade pick = Upgrade your pickaxe
echo upgrade bp = Upgrade your backpack
echo upgrade ore = Upgrade your ore
echo clear = Clear your screen
echo reload = Reload Command Miner
echo shop = Upgrade prices
echo tokenshop = Place where you can spend your Tokens
echo save = Save your progress
echo ore info = Info about ores
echo crates = Shows how many crates you have
echo open common = Open common crate
echo open uncommon = Open uncommon crate
echo open rare = Open rare crate
echo open epic = Open epic crate
echo open legendary = Open legendary crate
echo update = Update CM to latest version
echo allcommands = Show ALL commands including aliases (WIP)
echo set help = Settings
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
goto cmdselect


:saveProgress
if %cheats%==true goto saveCheats
cd save
cd..
echo Saved!
goto cmdselect



:saveCheats
echo You can't save your game if you used cheats
echo Use "reload" or "rl" to load your last saved position
goto cmdselect


:balance
echo.
echo Money: %money%^$
echo Tokens: %token%
goto cmdselect


:rebirth
if not %pickaxe%==Netherite goto rebirthFail
if not %backpack%==Netherite goto rebirthFail
set /a token=%token%+%tokenPlus%
set pickaxe=Wooden
set backpack=Wooden
set money=0
set ore=0
set commonCrate=0
set uncommonCrate=0
set rareCrate=0
set epicCrate=0
set legendaryCrate=0
echo Rebirth was successful
echo You got %tokenPlus% token(s)
goto cmdselect


:rebirthFail
echo You need to have Netherite backpack and pickaxe!
echo You only have %pickaxe% pickaxe and %backpack% backpack
goto cmdselect


:resetConfirm
echo Are you sure you want to start over? (y/n)
set command=invalid
set resetNY=n
if %resetNY%==y goto reset
if %resetNY%==n goto cmdselect
goto resetConfirm


:reset
set /a money=0
set /a token=0
set pickaxe=Wooden
set backpack=Wooden
set /a ore=0
set orename=Coal
set /a commonCrate=0
set /a uncommonCrate=0
set /a rareCrate=0
set /a epicCrate=0
set /a legendaryCrate=0
set /a minimumMined=0
set dimension=Overworld
set /a rebirthReward=0


cls
echo Done, reset was successful
goto main


:openCrateCommon
goto cmdselect


:openCrateUncommon
goto cmdselect


:openCrateRare
goto cmdselect


:openCrateEpic
goto cmdselect


:openCrateLegendary
goto cmdselect


:noCrate
echo [0;94m[Crate][0;0m You dont have any %crateName% crates!
goto cmdselect

:allCrates
echo.
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
echo Common:%commonCrate%
echo Uncommon:%uncommonCrate%
echo Rare:%rareCrate%
echo Epic:%epicCrate%
echo Legendary:%legendaryCrate%
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
goto cmdselect


:noPerms
echo [0;94m[Perms][0;0m You don't have permission for that command!
goto cmdselect


:update
if %internet%==none echo No internet connection & goto cmdselect
echo.
echo Are you sure you want to download latest version of Command Miner from 
echo https://fireroth.github.io/download/data/CommandMiner/latest?
echo Make sure you have repaired the update library
echo Otherwise you will be unable to update to newer version
echo [Y/N]
set UpdateConfirm=y
if %UpdateConfirm%==y del allcomm.bat &cd Command_Miner_Update & start /min Update.bat & exit
if %UpdateConfirm%==n goto cmdselect
goto update


:tokenShop
echo.
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
goto cmdselect



:version 
echo Current version: %ver%
goto cmdselect

:allcomm
start allcomm.bat
goto cmdselect


:setHelp
echo.
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
echo set cheats [/]
echo set debug [/]
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m
if %cheatPermission% == true (
echo.
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m 
echo set money [/]
echo set token [/]
echo set ore [/]
echo set pickaxe [/]
echo set backpack [/]
echo [0;33m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0;0m )

goto cmdselect


:Error0
cls
echo [0;31mAn unexpected error has occurred!
echo Operation was canceled[0;0m
goto main

:ErrorAdmin

echo [0;31mAdministrator mode is not supported!
echo Command Miner cannot be loaded[0;0m
echo Press any key to exit . . . 
pause>nul
exit

:ErrorInternet
echo [0;31mSlow or no internet connection!
echo Command Miner will not work properly[0;0m
pause
goto reload


REM DEBUG THINGS


:debug_menu
if not %debugPermission%==true goto noPerms
cls
echo 				[1;36m--------------------------------------------[0;0m 
echo.
echo               				    Command Miner Debug
echo.
echo 				[1;36m--------------------------------------------[0;0m 
title debug_menu
echo exit / goto / set
set /p debugOption=--^>
if %debugOption% == exit cls & cd.. & goto reload
if %debugOption% == goto goto debug1
if %debugOption% == stats goto debug_stats
if %debugOption% == savecheck goto saveCheck
if %debugOption% == set goto setVar
goto debug_menu

:debug1
cls
set /p gotoname=Enter function name: 
goto %gotoname%


:setVar
set /p varName=Enter variable name:
set /p value=Enter value:
set %varName%=%value%
goto debug_menu

:updateVM
cd Command_Miner_Update
del update.bat
echo Done
echo Command Miner will now close!
echo Please reOpen Command Miner.
echo [NOTE]: This command was executed automatically
pause
exit