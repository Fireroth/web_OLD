@echo off
echo [0;94m[PreStartup][0;0m Checking permissions...
net session >nul 2>&1
if %errorlevel% == 0 (
  goto errorAdmin
)
echo [0;94m[PreStartup][0;0m Checking internet connection...
ping www.google.com -n 1 -w 1000>nul
if errorlevel 1 (set internet=none& goto ErrorInternet) else (set internet=connected & echo [0;94m[PreStartup][0;0m Connected)

setlocal EnableDelayedExpansion
mode con cols=120 lines=30
@echo off
echo Starting up...
cd Command_Miner_Data
cd Command_Miner_Update
echo [0;94m[Startup][0;0m Setting up update feature...
if not exist Update.bat echo cd.. ^& cd.. ^& curl https://fireroth.github.io/download/data/CommandMiner/latest^>CommandMiner.bat ^& cd Command_Miner_Data ^& cd Command_Miner_Update ^& start Updated.vbs ^& exit>Update.bat & goto update
if not exist Updated.vbs echo X=MsgBox("Successfully installed latest version.",0+64,"Updated Command Miner")>Updated.vbs
cd..

goto updateVM



:update
if %internet%==none echo No internet connection & goto cmdselect
echo.
echo Are you sure you want to download latest version of Command Miner from 
echo https://fireroth.github.io/download/data/CommandMiner/latest?
echo Make sure you have repaired the update library
echo Otherwise you will be unable to update to newer version
echo [Y/N]
set UpdateConfirm=y
if %UpdateConfirm%==y del allcomm.bat &cd Command_Miner_Update & start /min Update.bat & exit
if %UpdateConfirm%==n goto cmdselect
goto update

:Error0
cls
echo [0;31mAn unexpected error has occurred!
echo Operation was canceled[0;0m
goto main

:ErrorAdmin
echo [0;31mAdministrator mode is not supported!
echo Command Miner cannot be loaded[0;0m
echo Press any key to exit . . . 
pause>nul
exit

:ErrorInternet
echo [0;31mSlow or no internet connection!
echo Command Miner cannot be loaded[0;0m
pause
exit


:updateVM
cd Command_Miner_Update
del update.bat
echo Done
echo Command Miner will now close!
echo Please reOpen Command Miner.
echo [NOTE]: This command was executed automatically
pause
exit