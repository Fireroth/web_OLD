@echo off
echo [0;94m[PreStartup][0;0m Checking permissions...
net session >nul 2>&1
if %errorlevel% == 0 (
  goto errorAdmin
)
echo [0;94m[PreStartup][0;0m Checking internet connection...
ping www.google.com -n 1 -w 1000>nul
if errorlevel 1 (set internet=none& goto ErrorInternet) else (set internet=connected & echo [0;94m[PreStartup][0;0m Connected)

:reload
setlocal EnableDelayedExpansion
mode con cols=120 lines=30
@echo off
echo Starting up...
if not exist Command_Miner_Data md Command_Miner_Data & echo [0;94m[Startup][0;0m Creating Command_Miner_Data folder
cd Command_Miner_Data & echo [0;94m[Startup][0;0m Entering Command_Miner_Data folder
if errorlevel=1 echo [0;94m[Startup][0;0m Failed to create folder! & pause >nul & exit
if not exist Command_Miner_Update md Command_Miner_Update & echo [0;94m[Startup][0;0m Creating Command_Miner_Update folder
cd Command_Miner_Update & echo [0;94m[Startup][0;0m Entering Command_Miner_Update folder
if errorlevel=1 echo [0;94m[Startup][0;0m Failed to create folder! & pause >nul & exit
echo [0;94m[Startup][0;0m Setting up update feature...
if not exist Update.bat echo cd.. ^& cd.. ^& curl https://fireroth.github.io/download/data/CommandMiner/latest^>CommandMiner.bat ^& cd Command_Miner_Data ^& cd Command_Miner_Update ^& start Updated.vbs ^& exit>Update.bat & goto update
if not exist Updated.vbs echo X=MsgBox("Successfully installed latest version.",0+64,"Updated Command Miner")>Updated.vbs
cd..
if not exist Config md Config & echo [0;94m[Startup][0;0m Creating Config folder
cd Config & if not exist cheatPerm.cmd echo set cheatPermission=false>cheatPerm.cmd & echo [0;94m[Startup][0;0m Creating cheatPerm.cmd file
if not exist debugPerm.cmd echo set debugPermission=false>debugPerm.cmd & echo [0;94m[Startup][0;0m Creating debugPerm.cmd file
cd..
if not exist Save md Save & echo [0;94m[Startup][0;0m Creating Save folder

echo [0;94m[Startup][0;0m Setting up important stuff...
set cheats=false
set command=invalid
set cheatPermission=false
set ver=1.0.3 MV

set /a minimumMined = 0
set pickaxe=Wooden
set backpack=Wooden
set money=0
set ore=0
set token=0
set oreName=Coal
set /a commonCrate=0
set /a uncommonCrate=0
set /a rareCrate=0
set /a epicCrate=0
set /a legendaryCrate=0
set dimension=Overworld
set /a rebirthReward=0

cd save
echo [0;94m[Startup][0;0m Calling saved files...
cd..
cd Config
cd..

cls
:main
curl https://fireroth.github.io/download/data/CommandMiner/logo
echo.
echo.
echo [0;91mMoved version, use [0;93mrepair[0;0m[0;91m to change the update library[0;0m
echo [0;91mAutomatic repair[0;0m

:cmdselect
set title=Command Miner (Moved Version)
goto updateVM

title %title%
echo.
set /p "command=Enter command:"
set count=0
for %%a in (%command%) do (
  set /a count+=1
  set command!count!=%%a
)

echo [0;31mPlease enter valid command![0;0m
goto cmdselect


:update
if %internet%==none echo No internet connection & goto cmdselect
echo.
echo Are you sure you want to download latest version of Command Miner from 
echo https://fireroth.github.io/download/data/CommandMiner/latest?
echo Make sure you have repaired the update library
echo Otherwise you will be unable to update to newer version
echo [Y/N]
set UpdateConfirm=y
if %UpdateConfirm%==y del allcomm.bat &cd Command_Miner_Update & start /min Update.bat & exit
if %UpdateConfirm%==n goto cmdselect
goto update




:Error0
cls
echo [0;31mAn unexpected error has occurred!
echo Operation was canceled[0;0m
goto main

:ErrorAdmin

echo [0;31mAdministrator mode is not supported!
echo Command Miner cannot be loaded[0;0m
echo Press any key to exit . . . 
pause>nul
exit

:ErrorInternet
echo [0;31mSlow or no internet connection!
echo Command Miner cannot be loaded[0;0m
pause
exit


:updateVM
cd Command_Miner_Update
del update.bat
echo Done
echo Command Miner will now close!
echo Please reOpen Command Miner.
echo [NOTE]: This command was executed automatically
pause
exit